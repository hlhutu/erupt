(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-283d295f"],{"0703":function(t,e,n){},"4e02":function(t,e,n){"use strict";n.d(e,"e",(function(){return r})),n.d(e,"f",(function(){return i})),n.d(e,"g",(function(){return u})),n.d(e,"h",(function(){return s})),n.d(e,"b",(function(){return c})),n.d(e,"m",(function(){return a})),n.d(e,"j",(function(){return p})),n.d(e,"k",(function(){return l})),n.d(e,"a",(function(){return m})),n.d(e,"d",(function(){return d})),n.d(e,"l",(function(){return f})),n.d(e,"i",(function(){return g})),n.d(e,"c",(function(){return h}));var o=n("0c6d");function r(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/group",method:"get",params:t})}function i(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/process/groups",method:"get",params:t})}function u(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/sort",method:"put",data:t})}function s(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/group/sort",method:"put",data:t})}function c(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/group",method:"post",params:{groupName:t}})}function a(t,e){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/group/"+t,method:"put",data:e})}function p(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/group/"+t,method:"delete"})}function l(t,e){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/"+t,method:"put",data:e})}function m(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form",method:"post",data:t})}function d(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/detail/"+t,method:"get"})}function f(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/detail",method:"put",data:t})}function g(t){return Object(o["a"])({url:"../erupt-api/erupt-flow/admin/form/"+t.formId,method:"delete",data:t})}function h(){return Object(o["a"])({url:"../erupt-api/erupt-flow/forms",method:"get"})}},"7f4c":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"panel",staticClass:"from-panel"},[n("div",{staticClass:"from-title"},[n("span",[t._v("流程面板")]),n("div",[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:function(e){return t.newProcess("")}}},[t._v("新建表单")]),n("el-button",{attrs:{icon:"el-icon-plus",size:"mini"},on:{click:t.addGroup}},[t._v("新建分组")])],1)]),n("draggable",{attrs:{list:t.groups,group:"group",handle:".group-sort",filter:".undrag",options:{animation:300,chosenClass:"choose",sort:!0,scroll:!0}},on:{start:function(t){},end:t.groupSort}},t._l(t.groups,(function(e,o){return n("div",{key:o,class:{"form-group":!0,undrag:!1}},[n("div",{staticClass:"form-group-title"},[n("span",[t._v(t._s(e.groupName))]),n("span",[t._v("("+t._s(e.items.length)+")")]),e.groupId>0?n("i",{staticClass:"el-icon-rank group-sort",attrs:{title:"长按拖动可对分组排序"}}):t._e(),e.groupId>0?n("div",[n("el-dropdown",[n("el-button",{staticStyle:{color:"#8c939d"},attrs:{type:"text",icon:"el-icon-setting"}},[t._v("编辑分组")]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{icon:"el-icon-edit-outline"},nativeOn:{click:function(n){return t.editGroup(e)}}},[t._v("修改名称")]),n("el-dropdown-item",{attrs:{icon:"el-icon-delete"},nativeOn:{click:function(n){return t.delGroup(e)}}},[t._v("删除分组")])],1)],1)],1):t._e()]),n("draggable",{staticStyle:{width:"100%","min-height":"25px"},attrs:{list:e.items,group:"group_"+e.groupId,filter:".undrag",handle:".form-sort",options:{animation:300,chosenClass:"choose",scroll:!0,sort:!0}},on:{end:t.formSort,start:function(n){t.movingGroup=e}}},t._l(e.items,(function(o,r){return n("div",{key:r,class:{"form-group-item":!0,undrag:!1}},[n("div",{staticClass:"form-sort",attrs:{title:"长按拖动进行排序"}},[n("i",{class:o.logo.icon,style:"background: "+o.logo.background}),n("span",[t._v(t._s(o.formName))])]),n("div",{staticClass:"desp"},[t._v(t._s(o.remark))]),n("div",[n("span",[t._v("最后更新："+t._s(o.updated))])]),n("div",[o.isStop?t._e():n("div",[n("el-button",{attrs:{icon:"el-icon-edit-outline",size:"mini",type:"text"},on:{click:function(n){return t.editFrom(o,e)}}},[t._v("编辑 ")]),n("el-button",{attrs:{type:"text",icon:"el-icon-close",size:"mini"},on:{click:function(e){return t.stopFrom(o)}}},[t._v("停用")]),n("el-popover",{staticStyle:{"margin-left":"10px"},attrs:{placement:"left",trigger:"click",width:"400"},on:{show:function(e){t.moveSelect}}},[n("el-radio-group",{attrs:{size:"mini"},model:{value:t.moveSelect,callback:function(e){t.moveSelect=e},expression:"moveSelect"}},t._l(t.groups,(function(o){return n("el-radio",{directives:[{name:"show",rawName:"v-show",value:o.groupId>0,expression:"g.groupId > 0"}],key:o.id,staticStyle:{margin:"10px"},attrs:{label:o.groupId,border:"",disabled:o.groupId===e.groupId}},[t._v(t._s(o.groupName)+" ")])})),1),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.moveFrom(o)}}},[t._v("确定")])],1),n("el-button",{attrs:{slot:"reference",icon:"el-icon-folder",size:"mini",type:"text"},slot:"reference"},[t._v("移动到 ")])],1)],1),o.isStop?n("div",[n("el-button",{attrs:{icon:"el-icon-edit-outline",size:"mini",type:"text"},on:{click:function(n){return t.editFrom(o,e)}}},[t._v("编辑 ")]),n("el-button",{attrs:{type:"text",icon:"el-icon-check",size:"mini"},on:{click:function(e){return t.stopFrom(o)}}},[t._v("启用")]),n("el-button",{attrs:{type:"text",icon:"el-icon-remove",size:"mini"},on:{click:function(e){return t.removeForm(o)}}},[t._v("删除")])],1):t._e()])])})),0),void 0!==e.items&&0!==e.items.length||0!==e.groupId?t._e():n("div",{staticStyle:{"text-align":"center"}},[n("p",{staticStyle:{color:"#C0C4CC"}},[t._v("没有分组的流程会显示在此处")])]),void 0!==e.items&&0!==e.items.length||-1!==e.groupId?t._e():n("div",{staticStyle:{"text-align":"center"}},[n("p",{staticStyle:{color:"#C0C4CC"}},[t._v("停用的流程会显示在此处")])]),(void 0===e.items||0===e.items.length)&&e.groupId>0?n("div",{staticStyle:{"text-align":"center"}},[n("el-button",{staticStyle:{"padding-top":"0"},attrs:{icon:"el-icon-plus",type:"text"},on:{click:function(n){return t.newProcess(e.groupId)}}},[t._v("创建新表单 ")])],1):t._e()],1)})),0)],1)},r=[],i=(n("4160"),n("d81d"),n("b0c0"),n("159b"),n("310e")),u=n.n(i),s=n("4e02"),c=n("3786"),a={name:"FormsPanel",components:{draggable:u.a},data:function(){return{moveSelect:"",movingGroup:{},visible:!1,groups:[]}},created:function(){sessionStorage.setItem("token",Object(c["a"])())},mounted:function(){this.getGroups()},methods:{getGroups:function(){var t=this;Object(s["e"])().then((function(e){t.groups=e.data,t.groups.forEach((function(t){t.items.forEach((function(t){t.logo=JSON.parse(t.logo)}))}))}))},newProcess:function(t){this.$store.commit("setTemplate",this.getTemplateData()),this.$store.commit("setIsEdit",!1),this.$router.push("/admin/design?_token="+Object(c["a"])()+"&groupId="+t)},groupSort:function(){var t=this;this.groups.length<=0||Object(s["h"])(this.groups.map((function(t){return t.groupId}))).then((function(e){t.getGroups()})).catch((function(e){t.getGroups(),t.$message.error(e.response.message)}))},formSort:function(){var t=this;this.movingGroup.items.length<=0||Object(s["g"])(this.movingGroup.items.map((function(t){return t.formId}))).then((function(e){t.movingGroup={},t.getGroups()})).catch((function(e){t.movingGroup={},t.getGroups(),t.$message.error(e.response.message)}))},addGroup:function(){var t=this;this.$prompt("请输入要添加的组名","新的分组名",{confirmButtonText:"提交",cancelButtonText:"取消",inputPattern:/^[\u4E00-\u9FA5A-Za-z0-9\\-]{1,30}$/,inputErrorMessage:"分组名不能为空且长度小于30",inputPlaceholder:"请输入分组名"}).then((function(e){var n=e.value;Object(s["b"])(n).then((function(e){t.$message.success(e.message),t.getGroups()})).catch((function(e){return t.$message.error(e.response.data)}))}))},delGroup:function(t){var e=this;t.items&&t.items.length>0?this.$message.warning("分组下有表单，禁止删除"):this.$confirm("确定要删除分组 "+t.groupName+"?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["j"])(t.groupId).then((function(t){e.$message.success(t.message),e.getGroups()})).catch((function(t){return e.$message.error(t.response.message)}))}))},editGroup:function(t){var e=this;this.$prompt("请输入新的组名","修改分组名",{confirmButtonText:"提交",cancelButtonText:"取消",inputPattern:/^[\u4E00-\u9FA5A-Za-z0-9\\-]{1,30}$/,inputErrorMessage:"分组名不能为空且长度小于30",inputPlaceholder:"请输入分组名",inputValue:t.name}).then((function(n){var o=n.value;Object(s["m"])(t.groupId,{groupId:t.groupId,groupName:o}).then((function(t){e.$message.success(t.message),e.getGroups()})).catch((function(t){return e.$message.error(t.response.data)}))}))},getTemplateData:function(t,e){return t},removeForm:function(t){var e=this;this.$confirm("删除流程后无法恢复，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["i"])(t).then((function(t){e.$message.success(t.message),e.getGroups(),e.moveSelect=null})).catch((function(t){return e.$message.error(t.response.message)}))}))},editFrom:function(t,e){this.$router.push("/admin/design?code="+t.formId+"&_token="+Object(c["a"])())},stopFrom:function(t){var e=this;t.isStop?this.$confirm("启用后将会进入 “其他” 分组，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["k"])(t.formId,{formId:t.formId,groupId:"0"}).then((function(t){e.$message.success(t.message),e.getGroups(),e.moveSelect=null})).catch((function(t){return e.$message.error(t.response.message)}))})):this.$confirm("流程停用后将会移到 “已停用” 分组，您可以再次启用或者删除它，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["k"])(t.formId,{formId:t.formId,groupId:"-1"}).then((function(t){e.$message.success(t.message),e.getGroups(),e.moveSelect=null})).catch((function(t){return e.$message.error(t.response.message)}))}))},moveFrom:function(t){var e=this;t.isStop?this.$message.warning("停用的流程禁止移动，你可以将其启用后移动"):null!==this.moveSelect&&""!==this.moveSelect?Object(s["k"])(t.formId,{formId:t.formId,groupId:this.moveSelect}).then((function(t){e.getGroups(),e.moveSelect=null})).catch((function(t){return e.$message.error(t.response.message)})):this.$message.error("请选择分组")}}},p=a,l=(n("cc79"),n("2877")),m=Object(l["a"])(p,o,r,!1,null,"7293bfb8",null);e["default"]=m.exports},cc79:function(t,e,n){"use strict";var o=n("0703"),r=n.n(o);r.a},d81d:function(t,e,n){"use strict";var o=n("23e7"),r=n("b727").map,i=n("1dde"),u=n("ae40"),s=i("map"),c=u("map");o({target:"Array",proto:!0,forced:!s||!c},{map:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-283d295f.ac9df58e.js.map